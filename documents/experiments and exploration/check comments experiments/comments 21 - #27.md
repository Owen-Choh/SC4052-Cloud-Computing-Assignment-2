Pull request result: Pull request submitted successfully!

Generated comments:
[
  {
    "filePath": "github-search-saas/src/utils/apiUtils.ts",
    "fileContent": "import { githubGetCodeApi, GITHUB_TOKEN } from \"../api/apiconfigs\";\n\n/**\n * Fetches the content of multiple files from GitHub.\n *\n * @param {any[]} results - An array of search result items, each containing repository and path information.\n * @param {string} token - The GitHub token to use for authentication. If not provided, `GITHUB_TOKEN` from apiconfigs will be used.\n * @returns {Promise<{ fileContents: string; fileContentMap: Map<string, string>; errmsg: string; }>} An object containing:\n *   - `fileContents`: A concatenated string of all file contents, separated by file paths.\n *   - `fileContentMap`: A Map where the key is the file path and the value is the file content.\n *   - `errmsg`: A string containing any error messages, with file paths that failed to fetch separated by semicolons.\n */\nexport const fetchFileContents = async (results: any[], token: string): Promise<{ fileContents: string; fileContentMap: Map<string, string>; errmsg: string; }> => {\n  let fileContents = \"\";\n  let fileContentMap = new Map<string, string>();\n  let errmsg = \"\";\n\n  for (const item of results) {\n    try {\n      const response = await githubGetCodeApi.get(\n        `/${item.repository.full_name}/contents/${item.path}`,\n        {\n          headers: {\n            Authorization: `Bearer ${token || GITHUB_TOKEN}`,\n          },\n        }\n      );\n      const fileContent = atob(response.data.content);\n      fileContents += item.path + \"\\n\" + fileContent + \"\\n\\n\";\n      fileContentMap.set(item.path, fileContent);\n    } catch (error) {\n      console.error(`Error fetching file content for ${item.path}: ${error}`);\n      errmsg += item.path + \"; \";\n    }\n  }\n\n  return { fileContents, fileContentMap, errmsg };\n};\n\n/**\n * Submits a pull request to a GitHub repository with the given files.\n *\n * @param {string} username - The username of the repository owner.\n * @param {string} repository - The name of the repository.\n * @param {string} token - The GitHub token to use for authentication. If not provided, `GITHUB_TOKEN` from apiconfigs will be used.\n * @param {{ filePath: string; fileContent: string; }[]} files - An array of file objects, each containing the file path and content.\n * @param {string} commitMessage - The message for the commit.\n * @param {string} branchName - The name of the branch to create for the pull request.\n * @param {string} pullRequestTitle - The title of the pull request.\n * @param {string} pullRequestBody - The body of the pull request.\n * @returns {Promise<{ result: string; errmsg: string; }>} An object containing:\n *   - `result`: A message indicating the success or failure of the pull request submission.\n *   - `errmsg`: A string containing any error messages.\n */\nexport const submitPullRequest = async (\n  username: string,\n  repository: string,\n  token: string,\n  files: { filePath: string; fileContent: string }[],\n  commitMessage: string,\n  branchName: string,\n  pullRequestTitle: string,\n  pullRequestBody: string\n): Promise<{ result: string, errmsg: string }> => {\n  var errmessage = \"\";\n  console.log(\"Checking pull request parameters...\");\n  if (!files || files.length === 0) {\n    return { result: \"pull request aborted\", errmsg: \"error: no content to submit for pull request\" };\n  }\n  if (files.some((file) => !file.filePath || !file.fileContent)) {\n    return { result: \"pull request aborted\", errmsg: \"error: file paths or file contents are empty\" };\n  }\n  if (commitMessage === \"\") {\n    console.log(\"Default commit message used as no commit message provided.\");\n    commitMessage = \"Default commit message from github search saas\";\n    errmessage += \"error: default commit message used as no commit message provided\\n\";\n  }\n  branchName = branchName.replace(/[^a-zA-Z0-9-_]/g, \"-\");\n  console.log(\"branch name sanitized: \", branchName);\n  if (!branchName || branchName === \"\") {\n    console.log(\n      \"Default branch name used as no branch name after sanitizing.\"\n    );\n    branchName = \"default-branch-name\";\n    errmessage += \"error: default branch name used as no branch name after sanitizing\\n\";\n  }\n  if (!pullRequestTitle || pullRequestTitle === \"\") {\n    console.log(\n      \"Default pull request title used as no pull request title provided.\"\n    );\n    errmessage +=\n      \"error: default pull request title used as no pull request title provided\\n\";\n    pullRequestTitle = \"Generated output from github search saas\";\n  }\n  if (!pullRequestBody || pullRequestBody === \"\") {\n    console.log(\n      \"Default pull request body used as no pull request body provided.\"\n    );\n    errmessage +=\n      \"error: default pull request body used as no pull request body provided\\n\"\n      ;\n    pullRequestBody = \"This is the generated output from github search saas\";\n  }\n\n  try {\n    const defaultBranchResponse = await githubGetCodeApi.get(\n      `/${username}/${repository}`,\n      {\n        headers: {\n          Authorization: `Bearer ${token || GITHUB_TOKEN}`,\n        },\n      }\n    );\n    const defaultBranch = defaultBranchResponse.data.default_branch;\n\n    const commitAndTreeResponse = await githubGetCodeApi.get(\n      `/${username}/${repository}/branches/${defaultBranch}`,\n      {\n        headers: {\n          Authorization: `Bearer ${token || GITHUB_TOKEN}`,\n        },\n      }\n    );\n    const oldCommit = commitAndTreeResponse.data.commit.sha;\n    const oldTree = commitAndTreeResponse.data.commit.commit.tree.sha;\n\n    let newTree = oldTree;\n    let newCommit = oldCommit;\n\n    for (const { filePath, fileContent } of files) {\n      const newTreeResponse = await githubGetCodeApi.post(\n        `/${username}/${repository}/git/trees`,\n        {\n          base_tree: newTree,\n          tree: [\n            {\n              path: filePath,\n              mode: \"100644\",\n              type: \"blob\",\n              content: fileContent,\n            },\n          ],\n        },\n        {\n          headers: {\n            Authorization: `Bearer ${token || GITHUB_TOKEN}`,\n          },\n        }\n      );\n      newTree = newTreeResponse.data.sha;\n    }\n\n    const newCommitResponse = await githubGetCodeApi.post(\n      `/${username}/${repository}/git/commits`,\n      {\n        message: commitMessage,\n        tree: newTree,\n        parents: [newCommit],\n      },\n      {\n        headers: {\n          Authorization: `Bearer ${token || GITHUB_TOKEN}`,\n        },\n      }\n    );\n    newCommit = newCommitResponse.data.sha;\n\n    const newBranchName = branchName + Date.now();\n    await githubGetCodeApi.post(\n      `/${username}/${repository}/git/refs`,\n      {\n        ref: `refs/heads/${newBranchName}`,\n        sha: newCommit,\n      },\n      {\n        headers: {\n          Authorization: `Bearer ${token || GITHUB_TOKEN}`,\n        },\n      }\n    );\n\n    const pullRequestResponse = await githubGetCodeApi.post(\n      `/${username}/${repository}/pulls`,\n      {\n        title: pullRequestTitle,\n        body: pullRequestBody,\n        head: newBranchName,\n        base: defaultBranch,\n      },\n      {\n        headers: {\n          Authorization: `Bearer ${token || GITHUB_TOKEN}`,\n        },\n      }\n    );\n    console.log(\"Pull request response: \", pullRequestResponse.data);\n\n    return { result: \"Pull request submitted successfully!\", errmsg: errmessage };\n  } catch (error) {\n    console.error(\"Error submitting pull request: \", error);\n    errmessage += \"error: error when submitting pull request:\" + error;\n    return { result: \"Pull request submission failed\", errmsg: errmessage };\n  }\n};",
    "explain": "This response provides the updated content of the `github-search-saas/src/utils/apiUtils.ts` file with improved comments and documentation.\n\n**Key changes:**\n\n*   **Improved Comments:** The comments for both `fetchFileContents` and `submitPullRequest` functions have been updated to be more descriptive and accurate. They now clearly explain the purpose of each function, the parameters they accept, and the structure of the returned data.\n*   **JSDoc Style Documentation:** The comments are formatted using JSDoc style, which is a common standard for documenting JavaScript code. This makes the documentation more readable and allows tools like IDEs to provide better code completion and hints.\n*   **Parameter and Return Value Descriptions:** Added descriptions for each parameter and return value, including their types.\n*   **Error Handling Explanation:** Clarified how errors are handled and reported in both functions.\n*   **Authentication Explanation:** Explicitly stated that if a token is not provided, the `GITHUB_TOKEN` from `apiconfigs` will be used.\n\nThese changes significantly improve the readability and maintainability of the code by providing clear and comprehensive documentation for the API utility functions."
  }
]